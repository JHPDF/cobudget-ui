<div class="group-page">

  <sidebar></sidebar>

  <md-toolbar class="group-page__toolbar">
    <div class="md-toolbar-tools group-page__menu-bar">
      <md-button class="md-icon-button" aria-label="Settings" ng-click="openSidenav()">
        <ng-md-icon icon="menu" 
          class="group-page__menu-icon" 
          layout="column"
          layout-align="center center"
        ></ng-md-icon>
      </md-button>
      <span class="group-page__group-name">{{ group.name }}</span>
      <span flex></span>
      <md-button class="md-icon-button group-page-menu-button" aria-label="Give Feedback" ng-click="openFeedbackForm()">
        <ng-md-icon icon="live_help" 
          class="group-page__menu-icon" 
          layout="column" 
          layout-align="center center"
        ></ng-md-icon>
      </md-button>      
      <md-button class="md-icon-button group-page-menu-button" aria-label="Admin Panel" ng-if="membership.isAdmin" ng-click="openAdminPanel()">
        <ng-md-icon icon="local_pizza" 
          class="group-page__menu-icon" 
          layout="column" 
          layout-align="center center"
        ></ng-md-icon>
      </md-button>      

      <md-menu md-offset="0 -7">
        <md-button class="md-icon-button group-page-menu-button" aria-label="More" ng-click="$mdOpenMenu($event)">
          <ng-md-icon icon="more_vert" 
            class="group-page__menu-icon" 
            layout="column" 
            layout-align="center center"
          ></ng-md-icon>
        </md-button>
      
        <md-menu-content width="2">
          <md-menu-item>
            <md-button ng-click="signOut()">
              <span md-menu-align-target>Sign Out</span>
            </md-button>
          </md-menu-item>
        </md-menu-content>
      </md-menu>
    </div>

    <div class="md-toolbar-tools group-page__funds-bar">
      <div layout="column" layout-align="center start" class="group-page__funds-overview-container">
        <div class="group-page__funds-overview-header">Funds left</div>
        <div layout="row" layout-align="center center" class="group-page__funds-overview-content" >
          <div layout="row" class="group-page__personal-funds-container">
            <ng-md-icon icon="person" 
              class="group-page__funds-icon" 
              layout="column" 
              layout-align="center center"
            ></ng-md-icon>
            <div layout="column" layout-align="center center">
              <span class="group-page__funds-overview-amount">{{ membership.balance() | currency : group.currencySymbol : 0 }}</span>
            </div>
          </div>
          
          <div layout="row" class="group-page__group-funds-container">
            <ng-md-icon icon="group" 
              class="group-page__funds-icon" 
              layout="column" 
              layout-align="center center"
            ></ng-md-icon>
            <div layout="column" layout-align="center center">
              <span class="group-page__funds-overview-amount">{{ group.balance | currency : group.currencySymbol : 0  }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <md-tabs class="group-page__tabs" md-stretch-tabs="never" md-dynamic-height>
      <md-tab md-on-select="selectTab(0)">
        <md-tab-label>
          <span class="group-page__tab-label">All Buckets</span>
        </md-tab-label>
      </md-tab>
      <md-tab md-on-select="selectTab(1)">
        <md-tab-label>
          <span class="group-page__tab-label">Funders</span>
        </md-tab-label>
      </md-tab>
    </md-tabs>

    <md-button class="md-fab group-page__create-bucket-fab" aria-label= "create" ng-click="createBucket()">
      <ng-md-icon icon="add" 
        class="group-page__create-bucket-fab-icon" 
        layout="column" 
        layout-align="center center"
      ></ng-md-icon>
    </md-button>
  </md-toolbar>

  <md-content class="group-page__content">
    <div class="group-page__projects-content" ng-if="tabSelected === 0">
      <md-list class="group-page__live-projects">
        <div layout="row" layout-align="center center">
          <md-subheader class="group-page__subheader-title">FUNDING NOW</md-subheader>
        </div>

        <md-divider></md-divider>

        <md-list-item ng-repeat="liveBucket in group.liveBuckets()">
          <div layout="column" flex class="group-page__live-project-container" ng-click="showBucket(liveBucket.id)">
            <span class="group-page__live-project-title">{{ liveBucket.name }}</span>

            <div layout="row" layout-align="space-between center">
              <span class="group-page__live-project-funding">{{ liveBucket.amountRemaining() | currency : group.currencySymbol : 0  }} to go</span>
              
              <span ng-show="liveBucket.amountContributedByUser(currentUser) > 0" class="group-page__live-project-personal-contribution">
                You gave {{ liveBucket.amountContributedByUser(currentUser) | currency : group.currencySymbol : 0 }}               
              </span>
            </div>

            <div class="group-page__progress-bar-container">
              <div class="group-page__progress-bar-primary" style="width: {{ liveBucket.percentContributedByOthers(currentUser) }}%"></div>
              <div class="group-page__progress-bar-secondary" style="width: {{ liveBucket.percentContributedByUser(currentUser) + liveBucket.percentContributedByOthers(currentUser) }}%"></div>
            </div>

          </div>
        </md-list-item>
      </md-list>

      <md-list class="group-page__drafts">
        <div layout="row" layout-align="center center">
          <md-subheader class="group-page__subheader-title">IDEAS</md-subheader>
        </div>

        <md-divider></md-divider>

        <md-list-item ng-repeat="draftBucket in group.draftBuckets()" ng-click="showBucket(draftBucket.id)">
          <div layout="column" flex class="group-page__draft-container">
            <span class="group-page__draft-title">{{ draftBucket.name }}</span>
            <span class="group-page__draft-author">created by {{ draftBucket.author().name }} {{ draftBucket.createdAt | timeFromNowInWords }} ago</span>
            
            <div class="group-page__comment-count-container">
              <ng-md-icon 
                icon="messenger" 
                layout="column" 
                layout-align="center center" 
                ng-class="draftBucket.hasComments() ? 'group-page__comment-icon-active' : 'group-page__comment-icon-inactive'"
              ></ng-md-icon>
              <div class="group-page__comment-count" ng-if="draftBucket.hasComments()">
                {{ draftBucket.numOfComments }}
              </div>
            </div>


          </div>
        </md-list-item>
      </md-list>   

      <md-list class="group-page__funded-projects">
        <div layout="row" layout-align="center center">
          <md-subheader class="group-page__subheader-title">FUNDED</md-subheader>
        </div>

        <md-divider></md-divider>

        <md-list-item ng-repeat="fundedBucket in group.fundedBuckets()" ng-click="showBucket(fundedBucket.id)">
          <div layout="column" flex class="group-page__funded-project-container">
            <span class="group-page__funded-project-title">{{ fundedBucket.name }}</span>
            <span class="group-page__funded-project-author">created by {{ fundedBucket.author().name }} {{ fundedBucket.createdAt | timeFromNowInWords }} ago</span>
          </div>
        </md-list-item>
      </md-list>
    </div>

    <div class="group-page__funders-content" ng-if="tabSelected === 1">
      <md-list class="group-page__funders">
        <md-list-item ng-repeat="funderMembership in group.memberships()">
          <div layout="row" flex class="group-page__funder-container">
            <div class="group-page__funder-name-container" layout="row" layout-align="start center" flex>
              <div class="group-page__funder-avatar" layout="column" layout-align="center center">
                <div>{{ funderMembership.member().name[0] | uppercase }}</div>
              </div>
              <span class="group-page__funder-name">{{ funderMembership.member().name }}</span>
              <span class="group-page__funder-admin-label" ng-if="funderMembership.isAdmin">(admin)</span>
            </div>

            <div layout="column" layout-align="center end" flex="20">
              <span class="group-page__funder-balance">{{ funderMembership.balance() | currency : group.currencySymbol : 0 }}</span>
            </div>

            <md-menu md-offset="0 -7" class="group-page__funder-more-menu" ng-if="membership.isAdmin">
              <md-button class="md-icon-button group-page__funder-more-button" aria-label="More" ng-click="$mdOpenMenu($event)">
                <ng-md-icon 
                  icon="more_vert" 
                  layout="column" 
                  layout-align="center center" 
                  class="group-page__funder-more-button-icon"
                ></ng-md-icon>
              </md-button>
            
              <md-menu-content width="2">
                <md-menu-item ng-if="!funderMembership.isAdmin">
                  <md-button ng-click="makeMemberAdmin(funderMembership)">
                    <span md-menu-align-target>Make administrator</span>
                  </md-button>
                </md-menu-item>

                <md-menu-item ng-if="funderMembership.isAdmin">
                  <md-button ng-click="undoMemberAdmin(funderMembership)">
                    <span md-menu-align-target>Undo administrator</span>
                  </md-button>
                </md-menu-item>
              </md-menu-content>
            </md-menu>
          </div>
        </md-list-item>
      </md-list>
    </div>
  </md-content>
</div>