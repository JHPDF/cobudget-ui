recase = require('recase').create({})
debug = require('debug')("users-store")

# ridiculous hack for @ngInject due to code at top from coffee class extension
null
### @ngInject ###
module.exports = ($http, RestfulStore, UserModel) ->
  class UsersStore extends RestfulStore

    path: (params = {}, op) ->
      debug("path", params, op)
      if op == "changePassword"
        "#{@baseUrl}/users/#{params.id}/change_password"
      else
        super(params, op)

    changePassword: (object) ->
      path = @path(object, "changePassword")
      debug("changePassword", path, object)
      self = @
      object = {
        user: recase.snakeCopy(object)
      }
      $http.post(path, object).then null, (err) ->
        debug("changePassword error", err)
        throw recase.camelCopy(err.data)

  new UsersStore(
    singular: "user"
    plural: "users"
    Model: UserModel
  )
