debug = require('debug')("users-store")

# ridiculous hack for @ngInject due to code at top from coffee class extension
null
### @ngInject ###
module.exports = ($http, RestfulStore, UserModel) ->
  class UsersStore extends RestfulStore

    path: (params = {}, op) ->
      debug("path", params, op)
      if op == "changePassword"
        "#{@baseUrl}/users/#{params.id}/change_password"
      else
        super(params, op)

    changePassword: (userCredentials) ->
      path = @path(userCredentials, "changePassword")
      debug("changePassword", path, userCredentials)
      self = @
      payload = {
        user: userCredentials
      }
      $http.post(path, payload).then null, (err) ->
        debug("changePassword error", err)
        throw err.data

  new UsersStore(
    singular: "user"
    plural: "users"
    Model: UserModel
  )
