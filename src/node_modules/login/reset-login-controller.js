var debug = require('debug')("login:reset-login-modal");

/* @ngInject */
module.exports = function ($scope, authModel, $modalInstance, AuthService) {

  debug("$scope", $scope)

  $scope.user = {
    resetPasswordToken: authModel.resetPasswordToken,
  };
  
  $scope.submit = function (resetLogin) {
    $scope.submitted = true

    debug("submitted", $scope.user, resetLogin)

    if ($scope.user.password !== $scope.user.passwordConfirmation) {
      resetLogin.passwordConfirmation.$setValidity("match", false);
    }

    if (resetLogin.$invalid) {
      debug("invalid", resetLogin);
      return;
    }

    AuthService.resetLogin($scope.user)
    .then(function () {
      $modalInstance.close($scope.user)
    }, function (err) {
      // check for handleable errors

      // otherwise pass error up
      $modalInstance.dismiss(err)
    });
  };

  $scope.cancel = function () {
    $modalInstance.dismiss(null);
  };
};
