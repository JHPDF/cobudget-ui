_ = require('lodash')

defineProperties = require('utils/define-properties')

### @ngInject ###
module.exports = (RoundModel) ->
  class GroupModel
    constructor: (data = {}) ->
      @id = data.id
      @name = data.name
      @rounds = _.map data.rounds, (round) ->
        new RoundModel(round)

      defineProperties @,
        members:
          deps: ['memberships']
          get: ->
            _.pluck @memberships, 'user'

    isAdmin: (user) ->
      if typeof @memberships == 'undefined'
        throw new Error("""
          Unable to check if user #{user.id}
          is admin of group #{@id}, do not
          have access to memberships
        """)

      membership = _.find @memberships, (m) ->
        m.user.id == user.id

      membership and membership.isAdmin
