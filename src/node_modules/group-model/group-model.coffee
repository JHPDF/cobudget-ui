_ = require('lodash')

defineProperties = require('utils/define-properties')

### @ngInject ###
module.exports = (RoundModel) ->
  class GroupModel
    constructor: (data = {}) ->
      @id = data.id
      @name = data.name
      @rounds = _.map data.rounds, (round) ->
        new RoundModel(round)

      defineProperties @,
        members:
          deps: ['memberships']
          get: ->
            _.pluck @memberships, 'member'

    getMembership: (member) ->
      if typeof @memberships == 'undefined'
        throw new Error("""
          Unable to find member #{member.id}
          membership in group #{@id}, do not
          have access to memberships
        """)

      _.find @memberships, (m) ->
        m.member.id == member.id

    isAdmin: (member) ->
      membership = @getMembership(member)
      membership and membership.isAdmin

    isMember: (member) ->
      not not @getMembership(member)
