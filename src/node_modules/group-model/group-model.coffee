_ = require('lodash')

defineProperties = require('utils/define-properties')

### @ngInject ###
module.exports = (RoundModel) ->
  class GroupModel
    constructor: (data = {}) ->
      @id = data.id
      @name = data.name
      @rounds = _.map data.rounds, (round) ->
        new RoundModel(round)

      defineProperties @,
        members:
          deps: ['memberships']
          get: ->
            _.pluck @memberships, 'user'

    getMembership: (user) ->
      if typeof @memberships == 'undefined'
        throw new Error("""
          Unable to find user #{user.id}
          membership in group #{@id}, do not
          have access to memberships
        """)

      _.find @memberships, (m) ->
        m.user.id == user.id

    isAdmin: (user) ->
      membership = @getMembership(user)
      membership and membership.isAdmin

    isMember: (user) ->
      not not @getMembership(user)
