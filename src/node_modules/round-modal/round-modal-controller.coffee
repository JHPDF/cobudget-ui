_ = require('lodash')

### @ngInject ###
module.exports = ($scope, $modalInstance, RoundsStore, RoundModel, group, round) ->

  $scope.group = group
  $scope.data = {}

  if round
    _.extend(
      $scope.data,
      round.serialize(),
      { groupId: group.id }
    )

    $scope.title = "Edit Round!"
  else
    $scope.title = "New Round!"

  $scope.submit = (roundForm) ->
    $scope.submitted = true

    if roundForm.$invalid
      return

    unsavedRound = new RoundModel($scope.data)

    # TODO error handling
    RoundsStore.save(unsavedRound)
    .then (savedRound) ->
      $modalInstance.close(savedRound)

  $scope.cancel = ->
    $modalInstance.dismiss('cancel')
