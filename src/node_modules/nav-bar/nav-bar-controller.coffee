_ = require('lodash')

### @ngInject ###
module.exports = ($scope, $stateParams, AuthService) ->

  if $stateParams.groupId
    $scope.selectedGroup = _.find $scope.groups, (group) ->
      group.id.toString() == $stateParams.groupId.toString()

  $scope.$watch 'selectedGroup', (group) ->
    if not $stateParams.groupId and group
      $state.go('layout.group', groupId: group.id)

  ///Dropdown stuff - to be moved to directive ///

  $scope.status = {
    isopen: false
  }

  $scope.toggleDropdown = ($event) ->
    $event.preventDefault()
    $event.stopPropagation()
    $scope.status.isopen = !$scope.status.isopen

  ///Dropdown stuff - to be moved to directive ///

  $scope.showLogin = () ->
    AuthService.loginModalCtrl.open()

  $scope.logout = () ->
    AuthService.logout()
