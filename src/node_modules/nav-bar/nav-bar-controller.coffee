_ = require('lodash')

### @ngInject ###
module.exports = ($scope, $state, $stateParams, AuthService) ->

  $scope.navbar = navbar =
    isopen: false

    toggleDropdown: ($event) ->
      $event.preventDefault()
      $event.stopPropagation()
      $scope.status.isopen = !$scope.status.isopen

    showLogin: () ->
      AuthService.loginModalCtrl.open()

    logout: () ->
      AuthService.logout()

  if $stateParams.groupId
    navbar.selectedGroup = _.find $scope.groups, (group) ->
      group.id.toString() == $stateParams.groupId.toString()

  $scope.$watch "groups", ->
    if not $stateParams.groupId and $scope.groups.length > 0
      $state.go('layout.group.rounds', { groupId: $scope.groups[0].id })
