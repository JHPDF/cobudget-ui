var ModalView = require('./modal-view');
var extend = require('xtend');

var currentModal = null;
var isClosingPrevious = false;

module.exports = function (options, callback) {

  // there can only be ONE modal at a time
  if (currentModal) {

    // hmm, TODO better solution for activating
    // multiple modals at once
    if (isClosingPrevious) {
      return;
    }

    isClosingPrevious = true;
    currentModal.close(null, function () {
      isClosingPrevious = false;

      newModal(options, callback);
    });

  } else {
    newModal(options, callback);
  }
};

function newModal (options, callback) {
  console.log("new modal", options)
  currentModal = new ModalView(extend(options, {
    callback: callback,
  }));
}
