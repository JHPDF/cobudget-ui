_ = require('lodash')

roundModal = require('round-modal')

### @ngInject ###
module.exports = ($scope, $modal, group, AuthService) ->

  $scope.isAdmin = group.isAdmin(AuthService.getCurrentUser())
  $scope.group = group

  handleError = (err) ->
    if (err and err != "backdrop click")
      $modal.open(
        require('error-modal')({ error: err })
      )

  $scope.openNewRoundModal = ->
    $modal.open(
      roundModal(
        group: group
      )
    ).result.then (round) ->
      # TODO add new round in proper sort order
      group.rounds.models.splice(0, 0, round)
    , handleError

  $scope.editRound = (round, index) ->
    $modal.open(
      roundModal(
        round: round
        group: group
      )
    ).result.then (round) ->
      group.rounds.models[index] = round
    , handleError
