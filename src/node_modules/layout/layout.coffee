### @ngInject ###
module.exports = {
  url: '/?reset_password_token'
  template: require('./layout-template.html')
  controller: require('./layout-controller.coffee')
  resolve:
    resetPasswordToken: ($stateParams, authModel) ->
      resetPasswordToken = $stateParams.reset_password_token
      authModel.set('resetPasswordToken', resetPasswordToken)
      resetPasswordToken

    groups: ($q, GroupsStore, authModel, login, $state) ->
      if authModel.id
        GroupsStore.all(memberId: authModel.id)
          .then null, (err) ->
            if (err.name == "ForbiddenError")
              # bad cookie
              login.logout()
              $state.reload()
            else
              $q.reject(err)
      else
        login.openLogin()
}
