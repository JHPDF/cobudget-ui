_ = require('lodash')

### @ngInject ###
module.exports = ($scope, $modal, $modalInstance, MembershipModel, MembershipsStore, group) ->

  $scope.group = group

  $scope.model = email: ""

  $scope.submit = (addMembersForm) ->
    $scope.submitted = true

    if addMembersForm.$invalid
      return

    unsavedMembership = new MembershipModel({
      member:
        email: $scope.model.email
      groupId: $scope.group.id
    })

    MembershipsStore.save(unsavedMembership)
    .then (savedMembership) ->
      $modalInstance.close([savedMembership])
    , (err) ->
      $modalInstance.dismiss(err)

  $scope.cancel = ->
    $modalInstance.dismiss(null)
