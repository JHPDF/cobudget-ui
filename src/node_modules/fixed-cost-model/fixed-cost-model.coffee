Decimal = require('big.js')

module.exports = ->
  class FixedCostModel
    constructor: (data = {}) ->
      @id = data.id
      @roundId = data.round_id
      @name = data.name
      @description = data.description

      if typeof data.amount_dollars != 'undefined'
        @amount = new Decimal(data.amount_dollars)
      else
        @amount = new Decimal(data.amount_cents or 0).div(100)

      Object.defineProperties @,
        amountCents:
          get: ->
            @amount.times(100).toFixed(0)
        amountDollars:
          get: ->
            @amount.toFixed(2)

    serialize: ->
      {
        id: @id
        round_id: @roundId
        name: @name
        description: @description
        amount_cents: @amountCents
      }

    save: (FixedCostStore) ->
      unsaved = @serialize()
      self = @
      FixedCostStore.save(unsaved).then (saved) ->
        if saved
          self.id = saved.id
