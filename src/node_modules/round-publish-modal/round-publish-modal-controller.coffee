_ = require('lodash')

### @ngInject ###
module.exports = ($scope, $modalInstance, RoundsStore, RoundModel, group, round) ->

  $scope.group = group
  $scope.data = round.serialize()
  $scope.data.groupId = group.id

  $scope.submit = (roundForm) ->
    $scope.submitted = true

    if roundForm.$invalid
      return

    unpublishedRound = new RoundModel($scope.data)

    RoundsStore.publish(unpublishedRound)
    .then (publishedRound) ->
      $modalInstance.close(publishedRound)
    , (err) ->
      $modalInstance.dismiss(err)

  $scope.cancel = ->
    $modalInstance.dismiss(null)
