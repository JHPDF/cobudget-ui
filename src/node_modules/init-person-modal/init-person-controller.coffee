_ = require('lodash')
debug = require('debug')("password-modal")

### @ngInject ###
module.exports = ($scope, $modalInstance, UserModel, UsersStore, person) ->

  $scope.person = person

  # update view model with existing properties
  $scope.model = {
    id: person.id
    name: person.name
    email: person.email
  }

  $scope.submit = (initPerson) ->
    $scope.submitted = true

    if initPerson.$invalid
      debug("invalid", initPerson)
      return

    unsavedPerson = new UserModel($scope.model)

    UsersStore.update(unsavedPerson)
    .then (savedPerson) ->
      $modalInstance.close(savedPerson)
    , (err) ->
      $modalInstance.dismiss(err)
