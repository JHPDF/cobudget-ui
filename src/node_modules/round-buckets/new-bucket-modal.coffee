_ = require('lodash')

### @ngInject ###
module.exports = ($scope, $modalInstance, BucketsStore, BucketModel, group, round, memberships) ->

  $scope.members = _.map memberships, (m) -> m.user

  $scope.submit = (newBucketForm) ->
    $scope.submitted = true

    if newBucketForm.$invalid
      return

    newBucket = new BucketModel({
      name: $scope.name
      description: $scope.description
      user: $scope.user
      targetCents: $scope.target * 100
      roundId: round.id
    })

    # TODO error handling
    BucketsStore.create(newBucket)
    .then (createdBucket) ->
      $modalInstance.close(createdBucket)

  $scope.cancel = ->
    $modalInstance.dismiss('cancel')
