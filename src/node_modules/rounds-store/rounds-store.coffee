_ = require('lodash')
recase = require('recase').create({})

# ridiculous hack for @ngInject due to code at top from coffee class extension
null
### @ngInject ###
module.exports = ($http, RestfulStore, RoundModel, ContributionModel, FixedCostModel) ->
  class RoundsStore extends RestfulStore
    getContributorDetails: (roundId, userId) ->
      path = @path(id: roundId)
      self = @
      $http.get("#{path}/contributors/#{userId}").then (response) ->
        details = recase.camelCopy(response.data.contributor)
        console.log(details)
        ret = {
          allocationAmountCents: details.allocationAmountCents
          contributions: []
        }
        ret.totalContributionsCents = 0
        for contribution in details.contributions
          ret.contributions.push(new ContributionModel(contribution))
          ret.totalContributionsCents += contribution.amountCents
        ret.fundsLeftCents = ret.allocationAmountCents - ret.totalContributionsCents

        return ret

  new RoundsStore(
    singular: "round"
    plural: "rounds"
    Model: RoundModel
  )