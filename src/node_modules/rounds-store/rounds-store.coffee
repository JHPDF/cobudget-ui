_ = require('lodash')
debug = require('debug')('rounds-store')
recase = require('recase').create({})

# ridiculous hack for @ngInject due to code at top from coffee class extension
null
### @ngInject ###
module.exports = ($http, RestfulStore, RoundModel, ContributionModel, FixedCostModel) ->
  class RoundsStore extends RestfulStore
    publish: (model) ->
      path = "#{@baseUrl}/rounds/#{model.getId()}/open_for_" +
        if model.membersCanProposeBuckets then 'proposals' else 'contributions'

      object = { round: {} }
      if model.startsAt
        object.round.starts_at = model.startsAt.toISOString()
      if model.endsAt
        object.round.ends_at = model.endsAt.toISOString()

      debug("publish", path, object)
      self = @
      $http.put(path, object).then (response) ->
        debug("publish res", response)
        recase.camelCopy(response.data)
      , @errorHandler

  new RoundsStore(
    singular: "round"
    plural: "rounds"
    Model: RoundModel
  )
