_ = require('lodash')

# ridiculous hack for @ngInject due to code at top from coffee class extension
null
### @ngInject ###
module.exports = ($http, RestfulStore, RoundModel, ContributionModel, FixedCostModel) ->
  class RoundsStore extends RestfulStore
    publish: (model) ->
      path = '/rounds/#{model.id}/open_for_' +
        if model.membersCanProposeBuckets then 'proposals' else 'contributions'
      object = @serialize(model)
      debug("publish", path, object)
      self = @
      $http.put(path, object).then (response) ->
        debug("publish res", response)
        self.deserialize(response.data)
      , @errorHandler

  new RoundsStore(
    singular: "round"
    plural: "rounds"
    Model: RoundModel
  )
